apply plugin: 'java-gradle-plugin'
apply plugin: 'java'
apply plugin: 'kotlin'

configurations {
  plugin_binaries
}

dependencies {
  testCompile gradleTestKit()

  compile "org.jetbrains.kotlin:kotlin-stdlib:$kotlin_version"

  compile project(':src:test-helper')

  plugin_binaries project(':src:gradle-plugin')
}

def pluginProject = project(':src:gradle-plugin')
test {
  dependsOn pluginProject.tasks.publishToMavenLocal
  dependsOn configurations.plugin_binaries

  useJUnit()

  systemProperty "TEST_DATA_HOME", "$projectDir"
  systemProperty "TEST_PLUGIN_CLASSPATH", "$pluginProject.group:gradle-plugin:$pluginProject.version"
  systemProperty "TEST_PLUGIN_NAME", "org.jonnyzzz.teamcity.dsl"
}
